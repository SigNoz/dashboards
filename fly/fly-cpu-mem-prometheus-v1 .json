{
  "description": "CPU utilisation and memory usage aggregated by app from Fly federated Prometheus metrics.",
  "layout": [
    {
      "h": 8,
      "i": "cpu_pct",
      "moved": false,
      "static": false,
      "w": 12,
      "x": 0,
      "y": 0
    },
    {
      "h": 8,
      "i": "cpu_user",
      "moved": false,
      "static": false,
      "w": 12,
      "x": 0,
      "y": 8
    },
    {
      "h": 8,
      "i": "cpu_system",
      "moved": false,
      "static": false,
      "w": 12,
      "x": 0,
      "y": 16
    },
    {
      "h": 8,
      "i": "mem_used_b",
      "moved": false,
      "static": false,
      "w": 12,
      "x": 0,
      "y": 24
    },
    {
      "h": 8,
      "i": "mem_used_p",
      "moved": false,
      "static": false,
      "w": 12,
      "x": 0,
      "y": 32
    },
    {
      "h": 8,
      "i": "mem_cached",
      "moved": false,
      "static": false,
      "w": 12,
      "x": 0,
      "y": 40
    }
  ],
  "panelMap": {},
  "tags": ["fly.io", "prometheus", "cpu", "memory"],
  "title": "Fly.io — CPU & Memory per App",
  "uploadedGrafana": false,
  "variables": {},
  "version": "v5",
  "widgets": [
    {
      "id": "cpu_pct",
      "isStacked": false,
      "nullZeroValues": "zero",
      "opacity": "1",
      "panelTypes": "graph",
      "query": {
        "builder": {
          "queryData": [],
          "queryFormulas": []
        },
        "clickhouse_sql": [
          {
            "disabled": true,
            "legend": "",
            "name": "A",
            "query": ""
          }
        ],
        "id": "q-cpu-pct",
        "promql": [
          {
            "disabled": false,
            "legend": "{{app}}",
            "name": "A",
            "query": "(100 * (1 - (sum by (app) (irate(fly_instance_cpu{mode=\"idle\"}[5m])) / sum by (app) (irate(fly_instance_cpu[5m]))))) OR avg by(app) (fly_instance_cpu_usage_percent)"
          }
        ],
        "queryType": "promql"
      },
      "timePreferance": "GLOBAL_TIME",
      "title": "CPU utilisation — % of total time by app",
      "yAxisUnit": "percent"
    },
    {
      "id": "cpu_user",
      "isStacked": false,
      "nullZeroValues": "zero",
      "opacity": "1",
      "panelTypes": "graph",
      "query": {
        "builder": {
          "queryData": [],
          "queryFormulas": []
        },
        "clickhouse_sql": [
          {
            "disabled": true,
            "legend": "",
            "name": "A",
            "query": ""
          }
        ],
        "id": "q-cpu-user",
        "promql": [
          {
            "disabled": false,
            "legend": "{{app}}",
            "name": "A",
            "query": "sum by(app) (irate(fly_instance_cpu{mode=\"user\"}[5m])) * 100"
          }
        ],
        "queryType": "promql"
      },
      "timePreferance": "GLOBAL_TIME",
      "title": "CPU user time — % by app",
      "yAxisUnit": "percent"
    },
    {
      "id": "cpu_system",
      "isStacked": false,
      "nullZeroValues": "zero",
      "opacity": "1",
      "panelTypes": "graph",
      "query": {
        "builder": {
          "queryData": [],
          "queryFormulas": []
        },
        "clickhouse_sql": [
          {
            "disabled": true,
            "legend": "",
            "name": "A",
            "query": ""
          }
        ],
        "id": "q-cpu-system",
        "promql": [
          {
            "disabled": false,
            "legend": "{{app}}",
            "name": "A",
            "query": "sum by(app) (irate(fly_instance_cpu{mode=\"system\"}[5m])) * 100"
          }
        ],
        "queryType": "promql"
      },
      "timePreferance": "GLOBAL_TIME",
      "title": "CPU system time — % by app",
      "yAxisUnit": "percent"
    },
    {
      "id": "mem_used_b",
      "isStacked": false,
      "nullZeroValues": "zero",
      "opacity": "1",
      "panelTypes": "graph",
      "query": {
        "builder": {
          "queryData": [],
          "queryFormulas": []
        },
        "clickhouse_sql": [
          {
            "disabled": true,
            "legend": "",
            "name": "A",
            "query": ""
          }
        ],
        "id": "q-mem-used-b",
        "promql": [
          {
            "disabled": false,
            "legend": "{{app}}",
            "name": "A",
            "query": "(sum by(app) (fly_instance_memory_mem_total) - sum by(app) (fly_instance_memory_mem_free))"
          }
        ],
        "queryType": "promql"
      },
      "timePreferance": "GLOBAL_TIME",
      "title": "Memory used — bytes by app",
      "yAxisUnit": "bytes"
    },
    {
      "id": "mem_used_p",
      "isStacked": false,
      "nullZeroValues": "zero",
      "opacity": "1",
      "panelTypes": "graph",
      "query": {
        "builder": {
          "queryData": [],
          "queryFormulas": []
        },
        "clickhouse_sql": [
          {
            "disabled": true,
            "legend": "",
            "name": "A",
            "query": ""
          }
        ],
        "id": "q-mem-used-p",
        "promql": [
          {
            "disabled": false,
            "legend": "{{app}}",
            "name": "A",
            "query": "100 * ((sum by(app) (fly_instance_memory_mem_total) - sum by(app) (fly_instance_memory_mem_free)) / sum by(app) (fly_instance_memory_mem_total))"
          }
        ],
        "queryType": "promql"
      },
      "timePreferance": "GLOBAL_TIME",
      "title": "Memory used — % of total by app",
      "yAxisUnit": "percent"
    },
    {
      "id": "mem_cached",
      "isStacked": false,
      "nullZeroValues": "zero",
      "opacity": "1",
      "panelTypes": "graph",
      "query": {
        "builder": {
          "queryData": [],
          "queryFormulas": []
        },
        "clickhouse_sql": [
          {
            "disabled": true,
            "legend": "",
            "name": "A",
            "query": ""
          }
        ],
        "id": "q-mem-cached",
        "promql": [
          {
            "disabled": false,
            "legend": "{{app}}",
            "name": "A",
            "query": "sum by(app) (fly_instance_memory_cached)"
          }
        ],
        "queryType": "promql"
      },
      "timePreferance": "GLOBAL_TIME",
      "title": "Memory cached — bytes by app",
      "yAxisUnit": "bytes"
    }
  ],
  "uuid": "01998cd8-260f-7d72-be16-630b3e630f11"
}
